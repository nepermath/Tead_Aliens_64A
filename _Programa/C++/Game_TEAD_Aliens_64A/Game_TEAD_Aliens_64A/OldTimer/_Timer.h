/*
	#-------------------------------------------------------------------------------#
	|																				|
 	|		   _____ _                      ______      _							|
 	|		  |_   _(_)                     |  _  \    (_)							|
 	|			| |  _ _ __ ___   ___ _ __  | | | |_ __ ___   _____ _ __			|
 	|			| | | | '_ ` _ \ / _ \ '__| | | | | '__| \ \ / / _ \ '__|			|
 	|			| | | | | | | | |  __/ |    | |/ /| |  | |\ V /  __/ |				|
 	|			\_/ |_|_| |_| |_|\___|_|    |___/ |_|  |_| \_/ \___|_|				|
 	|																				|
	| Este Drive implementa funções para manipulação de tempo , tais como delay		|
	| time_handle, time measure etc.												|
	#-------------------------------------------------------------------------------#
	| Este documento usa TAB 4 para formatação										|
	#-------------------------------------------------------------------------------#
	| Date: Brasilia ,12 de Agosto de 2016											|
	#-------------------------------------------------------------------------------#
 */


#ifndef _TIMER_H_
#define _TIMER_H_


/*
 +--------------------------------------+
 |        HARDWARE DEPENDENT INCLUDES	|
 +--------------------------------------+
*/

#if defined(ESP8266)
	//DEFINITIONS FOR NEPERINO V4.10
	#include <Arduino.h>
	#include <c_types.h>
#else
	//DEFINITIONS FOR NEPERINO V2.50 AND V3.50
	#include <avr/io.h>
	#include <avr/interrupt.h>
	#include <avr/pgmspace.h>
#endif

/*
 +--------------------------------------+
 |        HARDWARE DEPENDENT INCLUDES	|
 +--------------------------------------+
*/

/*
	+--------------------------------------+
	|       CONSTANTS DEFINITIONS	       |
	+--------------------------------------+
*/

//this below values is valid for crystal of 16Mhz

#define _TIMER_INTERRUPT_FREQUENCY 5000
#define _TIMER_PRESCALER		   8

/*
	+--------------------------------------+
	|       Typedef return function	       |
	+--------------------------------------+
*/
typedef void (*timerReturnCallBack)();

/*
        +-------------------------------------------------------+
        |        CLASS		TIMER			                    |
        +-------------------------------------------------------+
        | @PURPOSE      : to measure time						|
        | @OBSERVATIONS :										|
        +-------------------------------------------------------+
*/
class class_Timer
{
        /*
         +--------------------------------------+
         |       PRIVATE VARIABLES		        |
         +--------------------------------------+
        */
 private:
        /*
         +--------------------------------------+
         |       PRIVATE FUNCTIONS      	    |
         +--------------------------------------+
        */
		/************************************************************************/
		/* Initialize Timer                                                     */
		/************************************************************************/
		void	Initialize(void);			
		/************************************************************************/
		/* UnInitialize Timer                                                   */
		/************************************************************************/
		void	UnInitialize(void);		
        /*
         +--------------------------------------+
         |        PUBLIC FUNCTIONS		        |
         +--------------------------------------+
        */
public:
        
        /************************************************************************/
        /* Constructor                                                          */
        /************************************************************************/
        class_Timer(void);
        /************************************************************************/
        /* Destructor                                                           */
        /************************************************************************/
        ~class_Timer(void);
		/************************************************************************/
		/* timer Process                                                        */
		/************************************************************************/
		static void		timerProcess();
		/************************************************************************/
		/* Stop Timer                                                           */
		/************************************************************************/
		void		stop(void);
		/************************************************************************/
		/* Start Timer                                                          */
		/************************************************************************/
		void		start(void);
		/************************************************************************/
		/* Get Time in Milliseconds since boot                                  */
		/************************************************************************/
		uint32_t	getMilliseconds(void);
		/************************************************************************/
		/* Set Elapsed Time to measure times                                    */
		/************************************************************************/
		void		setElapsed(uint32_t	&elapsedTimer);
		/********************************************************************************/
		/* Get Elapsed time to measure timers											*/
		/* usage:																		*/
		/*	uint32_t	tMeter			Set Variable to measure timer					*/
		/*	SetElapsed(tMeter)			Set Actual Time									*/
		/*	:																			*/
		/*	:																			*/
		/*	elapsedTime=GetElapsed(tMeter)	Get Elapsed time since SetElapsed(tMeter)	*/
		/********************************************************************************/
		uint32_t	getElapsed(uint32_t &elapsedTimer);
		/************************************************************************/
		/* Delay a time in milliseconds                                         */
		/************************************************************************/
		void		delayMilliseconds(uint32_t milliseconds);
		/************************************************************************************/
		/* Set Handle interrupt with using timer call back at _TIMER_INTERRUPT_FREQUENCY	*/
		/************************************************************************************/
		void		setHandleCallBack(void (*_timerHandleCallBack)(void));
		/************************************************************************************/
		/* Get Handle interrupt																*/
		/************************************************************************************/
		timerReturnCallBack	getHandleCallBack(int8_t callBackIndex=0);
};




#endif /* _TIMER_H_ */